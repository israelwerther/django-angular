<!--   Core JS Files   -->
<script src="{{ ASSETS_ROOT }}/js/core/jquery.min.js"></script>
<script src="{{ ASSETS_ROOT }}/js/core/popper.min.js"></script>
<script src="{{ ASSETS_ROOT }}/js/core/bootstrap.min.js"></script>
<script src="{{ ASSETS_ROOT }}/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<!--  Google Maps Plugin    -->
<!-- Place this tag in your head or just before your close body tag. -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!-- Chart JS -->
<script src="{{ ASSETS_ROOT }}/js/plugins/chartjs.min.js"></script>
<!--  Notifications Plugin    -->
<script src="{{ ASSETS_ROOT }}/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Black Dashboard: parallax effects, scripts for the example pages etc -->
<script src="{{ ASSETS_ROOT }}/js/black-dashboard.min.js?v=1.0.0"></script>
<!-- Black Dashboard DEMO methods, don't include it in your project! -->
<script src="{{ ASSETS_ROOT }}/demo/demo.js"></script>
<script src="{{ ASSETS_ROOT }}/js/themeSettings.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  var app = new Vue({
    delimiters: ["${", "}"],
    el: "#app",
    data: {
      planets: [],
      selectedPlanet: null,
      planetDetails: null,
      loading: true, // Estado de carregamento
    },
    mounted() {
      this.fetchPlayerPlanets();
    },
    methods: {
      fetchPlayerPlanets() {
        this.loading = true; // Inicia o carregamento
        axios
          .get('{% url "api:users-list" %}')
          .then((response) => {
            const currentPlayer = response.data[0].current_player;
            this.planets = currentPlayer.planets;
            const currentPlanetId = currentPlayer.current_planet;
            this.fetchPlanetDetails(currentPlanetId);
          })
          .catch((error) => {
            console.error(error);
          })
          .finally(() => {
            this.loading = false;
          });
      },
      fetchPlanetDetails(planetId) {
        this.loading = true;
        axios
          .get(`/api/v1/planets/${planetId}/`)
          .then((response) => {
            this.planetDetails = response.data;
            this.selectedPlanet = response.data;
          })
          .catch((error) => {
            console.error(error);
          })
          .finally(() => {
            this.loading = false;
          });
      },
      selectPlanet(planet) {
        this.loading = true;
        axios
          .get(planet.urls.select)
          .then((response) => {
            this.selectedPlanet = response.data;
            this.fetchPlanetDetails(planet.id);
          })
          .catch((error) => {
            console.error(error);
          })
          .finally(() => {
            this.loading = false;
          });
      },
    },
  });
</script>
